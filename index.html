<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rugby Formation</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; width: 100%;
      overflow: hidden;
      font-family: sans-serif;
      box-sizing: border-box;
    }
    #app {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* Rugby field background */
    #fieldCanvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: #228B22; /* green background */
      display: block;
    }
    /* Dots container */
    #dotsContainer {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
    }

    .dot {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: grab;
      pointer-events: auto;
      user-select: none;
      touch-action: none;
    }

    /* Controls in bottom-right */
    #controls {
      position: absolute;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #playButton {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #positionSelect {
      font-size: 16px;
      padding: 6px;
      cursor: pointer;
    }

    /* Dot color assignments */
    .yellow { background-color: gold; }
    .red    { background-color: red; }
    .blue   { background-color: blue; }
    .white  { background-color: #ccc; }

    /* Responsive adjustments */
    @media (max-width: 600px) {
      .dot {
        width: 24px;
        height: 24px;
        font-size: 12px;
      }
      #playButton {
        font-size: 14px;
        padding: 8px 16px;
      }
      #positionSelect {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
<div id="app">
  <canvas id="fieldCanvas"></canvas>
  <div id="dotsContainer"></div>

  <!-- Controls at bottom-right -->
  <div id="controls">
    <button id="playButton">Play</button>
    <select id="positionSelect">
      <option>Kick off</option>
      <option>Scrum</option>
      <option>Left Maul</option>
      <option>Right Maul</option>
    </select>
  </div>
</div>

<script>
  // -- Canvas Setup & Drawing Field Lines --
  const fieldCanvas = document.getElementById('fieldCanvas');
  const ctx = fieldCanvas.getContext('2d');

  function resizeCanvas() {
    fieldCanvas.width = fieldCanvas.offsetWidth;
    fieldCanvas.height = fieldCanvas.offsetHeight;
    drawFieldLines();
  }

  // Draw a single white horizontal line through the center of the field
  function drawFieldLines() {
    const w = fieldCanvas.width;
    const h = fieldCanvas.height;
    ctx.clearRect(0, 0, w, h);
    ctx.strokeStyle = 'white';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, h/2);
    ctx.lineTo(w, h/2);
    ctx.stroke();
  }

  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('DOMContentLoaded', resizeCanvas);

  // -- Dot Setup --
  const dotsContainer = document.getElementById('dotsContainer');
  const playButton = document.getElementById('playButton');
  const positionSelect = document.getElementById('positionSelect');

  let isPlaying = false;

  // Formation positions (percentages for responsiveness)
  const formations = {
    "Kick off": [
      { label: '1',  color: 'yellow', x: 40,  y: 50 },
      { label: '2',  color: 'yellow', x: 42,  y: 50 },
      { label: '3',  color: 'yellow', x: 44,  y: 50 },
      { label: '4',  color: 'red',    x: 46,  y: 48 },
      { label: '5',  color: 'red',    x: 48,  y: 48 },
      { label: '6',  color: 'blue',   x: 46,  y: 52 },
      { label: '7',  color: 'blue',   x: 48,  y: 52 },
      { label: '8',  color: 'red',    x: 50,  y: 50 },
      { label: '9',  color: 'white',  x: 52,  y: 48 },
      { label: '10', color: 'white',  x: 54,  y: 48 },
      { label: '11', color: 'white',  x: 52,  y: 52 },
      { label: '12', color: 'white',  x: 54,  y: 52 },
      { label: '13', color: 'white',  x: 56,  y: 50 },
      { label: '14', color: 'white',  x: 58,  y: 50 },
      { label: '15', color: 'white',  x: 60,  y: 50 },
    ],
    "Scrum": [
      { label: '1',  color: 'yellow', x: 30,  y: 50 },
      { label: '2',  color: 'yellow', x: 32,  y: 50 },
      { label: '3',  color: 'yellow', x: 34,  y: 50 },
      { label: '4',  color: 'red',    x: 36,  y: 48 },
      { label: '5',  color: 'red',    x: 38,  y: 48 },
      { label: '6',  color: 'blue',   x: 36,  y: 52 },
      { label: '7',  color: 'blue',   x: 38,  y: 52 },
      { label: '8',  color: 'red',    x: 40,  y: 50 },
      { label: '9',  color: 'white',  x: 42,  y: 48 },
      { label: '10', color: 'white',  x: 44,  y: 48 },
      { label: '11', color: 'white',  x: 42,  y: 52 },
      { label: '12', color: 'white',  x: 44,  y: 52 },
      { label: '13', color: 'white',  x: 46,  y: 50 },
      { label: '14', color: 'white',  x: 48,  y: 50 },
      { label: '15', color: 'white',  x: 50,  y: 50 },
    ],
    "Left Maul": [
      { label: '1', color: 'yellow', x: 20, y: 40 },
      { label: '2', color: 'yellow', x: 22, y: 42 },
      { label: '3', color: 'yellow', x: 24, y: 44 },
      { label: '4', color: 'red',    x: 26, y: 46 },
      { label: '5', color: 'red',    x: 28, y: 48 },
      { label: '6', color: 'blue',   x: 30, y: 44 },
      { label: '7', color: 'blue',   x: 32, y: 46 },
      { label: '8', color: 'red',    x: 34, y: 45 },
      { label: '9', color: 'white',  x: 36, y: 44 },
      { label: '10',color: 'white',  x: 38, y: 46 },
      { label: '11',color: 'white',  x: 36, y: 48 },
      { label: '12',color: 'white',  x: 38, y: 50 },
      { label: '13',color: 'white',  x: 40, y: 46 },
      { label: '14',color: 'white',  x: 42, y: 48 },
      { label: '15',color: 'white',  x: 44, y: 50 },
    ],
    "Right Maul": [
      { label: '1', color: 'yellow', x: 60, y: 40 },
      { label: '2', color: 'yellow', x: 62, y: 42 },
      { label: '3', color: 'yellow', x: 64, y: 44 },
      { label: '4', color: 'red',    x: 66, y: 46 },
      { label: '5', color: 'red',    x: 68, y: 48 },
      { label: '6', color: 'blue',   x: 70, y: 44 },
      { label: '7', color: 'blue',   x: 72, y: 46 },
      { label: '8', color: 'red',    x: 74, y: 45 },
      { label: '9', color: 'white',  x: 76, y: 44 },
      { label: '10',color: 'white',  x: 78, y: 46 },
      { label: '11',color: 'white',  x: 76, y: 48 },
      { label: '12',color: 'white',  x: 78, y: 50 },
      { label: '13',color: 'white',  x: 80, y: 46 },
      { label: '14',color: 'white',  x: 82, y: 48 },
      { label: '15',color: 'white',  x: 84, y: 50 },
    ]
  };

  let dots = [];
  let currentFormation = "Kick off";
  let lineCanvas, lineCtx;

  // Create a canvas for drawing dot movement lines
  function createLineCanvas() {
    lineCanvas = document.createElement('canvas');
    lineCanvas.style.position = 'absolute';
    lineCanvas.style.top = '0';
    lineCanvas.style.left = '0';
    lineCanvas.width = fieldCanvas.width;
    lineCanvas.height = fieldCanvas.height;
    dotsContainer.appendChild(lineCanvas);
    lineCtx = lineCanvas.getContext('2d');
  }

  function resizeLineCanvas() {
    if (lineCanvas) {
      lineCanvas.width = fieldCanvas.width;
      lineCanvas.height = fieldCanvas.height;
    }
  }
  window.addEventListener('resize', resizeLineCanvas);

  // Initialize dots based on the selected formation
  function initDots(formationName) {
    dotsContainer.innerHTML = '';
    createLineCanvas();
    dots = [];
    const formation = formations[formationName];

    formation.forEach(player => {
      const dot = document.createElement('div');
      dot.classList.add('dot', player.color);
      dot.textContent = player.label;
      dot.dataset.label = player.label;
      dot.dataset.color = player.color;
      dot.dataset.xPercent = player.x;
      dot.dataset.yPercent = player.y;
      positionDot(dot, player.x, player.y);
      makeDraggable(dot);
      dotsContainer.appendChild(dot);
      dots.push(dot);
    });
  }

  // Position a dot based on percentages
  function positionDot(dot, xPercent, yPercent) {
    const rect = dotsContainer.getBoundingClientRect();
    const leftPx = (xPercent / 100) * rect.width;
    const topPx  = (yPercent / 100) * rect.height;
    dot.style.left = (leftPx - dot.offsetWidth / 2) + 'px';
    dot.style.top  = (topPx - dot.offsetHeight / 2) + 'px';
  }

  function repositionDots() {
    dots.forEach(dot => {
      const x = parseFloat(dot.dataset.xPercent);
      const y = parseFloat(dot.dataset.yPercent);
      positionDot(dot, x, y);
    });
  }
  window.addEventListener('resize', repositionDots);

  // Make dots draggable (supports mouse and touch)
  function makeDraggable(dot) {
    let offsetX, offsetY, isDragging = false, lastX, lastY;
    function onPointerDown(e) {
      isDragging = true;
      dot.style.cursor = 'grabbing';
      const rect = dot.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
      lastX = rect.left + rect.width / 2;
      lastY = rect.top + rect.height / 2;
      e.preventDefault();
    }
    function onPointerMove(e) {
      if (!isDragging) return;
      const parentRect = dotsContainer.getBoundingClientRect();
      let newX = e.clientX - parentRect.left - offsetX;
      let newY = e.clientY - parentRect.top - offsetY;
      dot.style.left = newX + 'px';
      dot.style.top  = newY + 'px';
      if (isPlaying && lineCtx) {
        lineCtx.strokeStyle = 'white';
        lineCtx.lineWidth = 2;
        lineCtx.beginPath();
        lineCtx.moveTo(lastX, lastY);
        lineCtx.lineTo(parentRect.left + newX + dot.offsetWidth / 2,
                       parentRect.top  + newY + dot.offsetHeight / 2);
        lineCtx.stroke();
        lastX = parentRect.left + newX + dot.offsetWidth / 2;
        lastY = parentRect.top + newY + dot.offsetHeight / 2;
      }
    }
    function onPointerUp(e) {
      isDragging = false;
      dot.style.cursor = 'grab';
      const rect = dot.getBoundingClientRect();
      const parentRect = dotsContainer.getBoundingClientRect();
      const centerX = (rect.left + rect.width / 2) - parentRect.left;
      const centerY = (rect.top + rect.height / 2) - parentRect.top;
      dot.dataset.xPercent = (centerX / parentRect.width) * 100;
      dot.dataset.yPercent = (centerY / parentRect.height) * 100;
    }
    dot.addEventListener('pointerdown', onPointerDown);
    window.addEventListener('pointermove', onPointerMove);
    window.addEventListener('pointerup', onPointerUp);
  }

  // Initialize default formation
  initDots(currentFormation);

  // Play/Reset button handling
  playButton.addEventListener('click', () => {
    if (!isPlaying) {
      isPlaying = true;
      playButton.textContent = 'Reset';
      playButton.style.backgroundColor = 'red';
    } else {
      isPlaying = false;
      playButton.textContent = 'Play';
      playButton.style.backgroundColor = '';
      initDots(currentFormation);
    }
  });

  // Formation change handling
  positionSelect.addEventListener('change', (e) => {
    currentFormation = e.target.value;
    initDots(currentFormation);
    isPlaying = false;
    playButton.textContent = 'Play';
    playButton.style.backgroundColor = '';
  });
</script>
</body>
</html>
